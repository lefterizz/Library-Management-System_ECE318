<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import org.controlsfx.control.*?>

<BorderPane xmlns="http://javafx.com/javafx/17.0.12"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.example.ece318_librarymanagementsys_uc1069790.MainController">

    <!-- ─── TOP BAR ─────────────────────────────── -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-background-color: #2c3e50;">
            <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
            <Label text="Lefteris Library Management System"
                   style="-fx-text-fill: white; -fx-font-size: 18px;"/>
        </HBox>
    </top>

    <!-- ─── CENTER CONTENT ─────────────────────────────── -->
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" tabMaxWidth="435" tabMinWidth="435">

            <!-- ─── BOOKS TAB ─────────────────────────────── -->
            <Tab fx:id="booksTab" text="Books">
                <BorderPane fx:id="booksPane">

                    <!-- Top controls -->
                    <top>
                        <HBox spacing="10">
                            <padding><Insets top="10" bottom="10" left="10" right="10"/></padding>
                            <Button fx:id="loadBooksButton" text="Load Books CSV" onAction="#onLoadBooks"/>
                            <TextField fx:id="searchBooksField" prefWidth="300" promptText="Search by title or author..."/>
                            <CheckComboBox fx:id="filterGenreBox" prefWidth="200" title="Filter by Genre"/>
                            <CheckComboBox fx:id="filterSubGenreBox" prefWidth="200" title="Filter by Sub-Genre"/>
                            <Button fx:id="exportBooksButton" text="Export PDF" onAction="#onExportBooks"/>
                        </HBox>
                    </top>

                    <!-- Table + Details panel -->
                    <center>
                        <HBox fx:id="booksContentArea" spacing="10">
                            <TableView fx:id="booksTable" HBox.hgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colTitle" text="Title"/>
                                    <TableColumn fx:id="colAuthor" text="Author"/>
                                    <TableColumn fx:id="colGenre" text="Genre"/>
                                    <TableColumn fx:id="colSubGenre" text="Sub-Genre"/>
                                    <TableColumn fx:id="colPrice" text="Price"/>
                                    <TableColumn fx:id="colRating" text="Rating"/>
                                </columns>
                            </TableView>

                            <VBox fx:id="bookDetailsPanel" prefWidth="400"
                                  style="-fx-background-color:#ecf0f1; -fx-padding:15; -fx-border-color:#bdc3c7; -fx-border-width:1;">

                                <HBox alignment="TOP_RIGHT">
                                    <Button fx:id="closeDetailsBtn" text="✕"
                                            style="-fx-background-color:transparent; -fx-font-size:16px; -fx-text-fill:#555;"
                                            onAction="#onCloseBookDetails"/>
                                </HBox>

                                <Label fx:id="lblBookTitle" wrapText="true"
                                       style="-fx-font-size:16px; -fx-font-weight:bold;"/>
                                <Separator/>
                                <Label fx:id="lblBookAuthor"/>
                                <Label fx:id="lblBookGenre"/>
                                <Label fx:id="lblBookSubGenre"/>
                                <Label fx:id="lblBookType"/>
                                <Label fx:id="lblBookPrice"/>
                                <Label fx:id="lblBookRating"/>
                                <Label fx:id="lblBookRatingsCount"/>
                                <Hyperlink fx:id="lblBookURL" text="View on Amazon"/>
                            </VBox>
                        </HBox>
                    </center>

                    <!-- Bottom buttons -->
                    <bottom>
                        <HBox alignment="CENTER" spacing="10">
                            <padding><Insets top="10" bottom="10"/></padding>
                            <Button fx:id="addBookBtn" text="Add" onAction="#onAddBook"/>
                            <Button fx:id="editBookBtn" text="Edit" onAction="#onEditBook"/>
                            <Button fx:id="deleteBookBtn" text="Delete" onAction="#onDeleteBook"/>
                        </HBox>
                    </bottom>
                </BorderPane>
            </Tab>

            <!-- ─── GENRES TAB ─────────────────────────────── -->
            <Tab fx:id="genresTab" text="Genres">
                <BorderPane fx:id="genresPane">

                    <top>
                        <HBox spacing="10">
                            <padding><Insets top="10" bottom="10" left="10" right="10"/></padding>
                            <TextField fx:id="searchGenreField" prefWidth="300" promptText="Search by genre name..."/>
                            <Button fx:id="reloadGenresButton" text="Reload Genres CSV" onAction="#onReloadGenres"/>
                            <Button fx:id="exportGenresButton" text="Export PDF" onAction="#onExportGenres"/>
                        </HBox>
                    </top>

                    <center>
                        <HBox fx:id="genresContentArea" spacing="10">
                            <TableView fx:id="genresTable" HBox.hgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colGenreName" text="Genre"/>
                                    <TableColumn fx:id="colNumSubGenres" text="No. of Sub-genres"/>
                                    <TableColumn fx:id="colTotalBooks" text="Total Books"/>
                                    <TableColumn fx:id="colAvgRating" text="Avg Rating"/>
                                    <TableColumn fx:id="colAvgPrice" text="Avg Price"/>
                                    <TableColumn fx:id="colGenreURL" text="URL"/>
                                </columns>
                            </TableView>

                            <VBox fx:id="genreDetailsPanel" prefWidth="360"
                                  style="-fx-background-color:#ecf0f1; -fx-padding:15; -fx-border-color:#bdc3c7; -fx-border-width:1;">

                                <HBox alignment="TOP_RIGHT">
                                    <Button fx:id="closeGenreDetailsBtn" text="✕"
                                            style="-fx-background-color:transparent; -fx-font-size:16px; -fx-text-fill:#555;"
                                            onAction="#onCloseGenreDetails"/>
                                </HBox>

                                <Label fx:id="lblGenreName" wrapText="true"
                                       style="-fx-font-size:16px; -fx-font-weight:bold;"/>
                                <Separator/>
                                <Label fx:id="lblGenreTotalBooks"/>
                                <Label fx:id="lblGenreAvgRating"/>
                                <Label fx:id="lblGenreAvgPrice"/>
                                <Separator/>
                                <Label text="Sub-genres:" style="-fx-font-weight:bold;"/>
                                <ListView fx:id="lvGenreSubGenres" prefHeight="180"/>
                                <Hyperlink fx:id="lblGenreURL" text="View on Amazon"/>
                            </VBox>
                        </HBox>
                    </center>

                    <bottom>
                        <HBox alignment="CENTER" spacing="10">
                            <padding><Insets top="10" bottom="10"/></padding>
                            <Button fx:id="addGenreBtn" text="Add" onAction="#onAddGenre"/>
                            <Button fx:id="editGenreBtn" text="Edit" onAction="#onEditGenre"/>
                            <Button fx:id="deleteGenreBtn" text="Delete" onAction="#onDeleteGenre"/>
                        </HBox>
                    </bottom>
                </BorderPane>
            </Tab>

            <!-- ─── SUBGENRES TAB ─────────────────────────────── -->
            <Tab fx:id="subGenresTab" text="Sub-genres">
                <BorderPane fx:id="subGenresPane">

                    <top>
                        <HBox spacing="10">
                            <padding><Insets top="10" bottom="10" left="10" right="10"/></padding>
                            <TextField fx:id="searchSubGenreField" prefWidth="300"
                                       promptText="Search by sub-genre name..."/>
                            <Button fx:id="reloadSubGenresButton" text="Reload SubGenres CSV" onAction="#onReloadSubGenres"/>
                            <Button fx:id="exportSubGenresButton" text="Export PDF" onAction="#onExportSubGenres"/>
                        </HBox>
                    </top>

                    <center>
                        <TableView fx:id="subGenresTable">
                            <columns>
                                <TableColumn fx:id="colSubGenreName" text="Sub-Genre"/>
                                <TableColumn fx:id="colParentGenre" text="Main Genre"/>
                                <TableColumn fx:id="colSubGenreBooks" text="Books"/>
                                <TableColumn fx:id="colSubGenreAvgRating" text="Avg Rating"/>
                                <TableColumn fx:id="colSubGenreAvgPrice" text="Avg Price"/>
                                <TableColumn fx:id="colSubGenreURL" text="URL"/>
                            </columns>
                        </TableView>
                    </center>

                    <bottom>
                        <HBox alignment="CENTER" spacing="10">
                            <padding><Insets top="10" bottom="10"/></padding>
                            <Button fx:id="addSubGenreBtn" text="Add" onAction="#onAddSubGenre"/>
                            <Button fx:id="editSubGenreBtn" text="Edit" onAction="#onEditSubGenre"/>
                            <Button fx:id="deleteSubGenreBtn" text="Delete" onAction="#onDeleteSubGenre"/>
                        </HBox>
                    </bottom>
                </BorderPane>
            </Tab>

        </TabPane>
    </center>

</BorderPane>
